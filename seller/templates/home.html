{% extends 'base.html' %}
{% load staticfiles %} 

{% block content %}
<div class="container">
<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />
<h1>seller GEO-Test</h1>

<div class="row">
<div class="col-md-8">
<div id="mapid" style="height: 400px; margin-bottom: 30px;"></div>
</div>
</div>
<form method="post" action="./">
    {% csrf_token %}
    <input id="id_address" name="address" value="{{ location2 }}" type="hidden">
    <input type="submit" value="Search" />
</form>

{% if sellers %}
<h2>sellers near you</h2>
<ul>
    {% for seller in sellers %}
    <li><b>{{ seller.name }}</b>: distance: {{ seller.distance }}</li>
    {% endfor %}
</ul>
{% endif %}
</div>
{% endblock %}

{% block javascript %}
<script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>
<script>
    var mymap = L.map('mapid').setView([{{ location1 }}], 12);

    L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpandmbXliNDBjZWd2M2x6bDk3c2ZtOTkifQ._QA7i5Mpkd_m30IGElHziw', {
        maxZoom: 20,
        attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a>',
        id: 'mapbox.streets'
    }).addTo(mymap);

    var popup = L.popup();

    function onMapClick(e) {
        $('#id_address').val(e.latlng.lng+' '+e.latlng.lat);
        popup
            .setLatLng(e.latlng)
            .setContent(e.latlng.toString())
            .openOn(mymap);
    }

    mymap.on('click', onMapClick);
</script>   
{% endblock %}